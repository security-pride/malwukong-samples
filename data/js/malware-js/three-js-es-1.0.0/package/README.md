# ä¸­æ–‡ä»£ç ç©3D three.js

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ Three.js æ„å»ºçš„ç®€å•åœºæ™¯ã€‚ä»£ç ä¸­åŒ…å«äº†ä¸€ä¸ª HTML æ¨¡æ¿å’Œ JavaScript è„šæœ¬ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªæ—‹è½¬çš„ç«‹æ–¹ä½“ã€ä¸€ä¸ªæ—‹è½¬çš„åœ†å½¢å’Œä¸€ä¸ªæ—‹è½¬çš„çƒä½“ï¼Œä»¥åŠä¸€ä¸ªåŠ è½½è‡ªå®šä¹‰æ¨¡å‹çš„å†°å¢©å¢©ã€‚

# demo https://unpkg.com/three-js-es/index.html

## å¦‚ä½•è¿è¡Œ

1. ä¸‹è½½ä»£ç 
2. åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦
3. è¿è¡Œ `npm i three-js-es` å®‰è£…ä¾èµ–é¡¹
4. è¿è¡Œ `npm run build` æˆ– `npm run watch` ç¼–è¯‘ä»£ç 
5. æ‰“å¼€ `index.html` æŸ¥çœ‹åœºæ™¯

## ä»£ç è¯´æ˜

### HTML æ¨¡æ¿

åœ¨ HTML æ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª `script` å…ƒç´ ï¼Œå¹¶åœ¨å…¶ä¸­ä½¿ç”¨äº†ä¸€ä¸ªè‡ªå®šä¹‰å…ƒç´  `domElement`ã€‚

```html
<body>
    <script id="æˆ‘çš„åœºæ™¯" type="domElement">
      <åœºæ™¯>
          <é€è§†æ‘„åƒæœº è§†é‡è§’åº¦="50" é•¿å®½æ¯”="è‡ªé€‚åº”" æœ€å°å¯è§†èŒƒå›´="0.1" æœ€å¤§å¯è§†èŒƒå›´="1000" />
          <æ§åˆ¶å™¨ ç±»å‹="è½¨é“">
              <å‚æ•° ç±»å‹="ä½ç½®" x="0" y="4" z="20" />
              <å‚æ•° ç±»å‹="èšç„¦" x="0" y="4" z="0" />
          </æ§åˆ¶å™¨>
          <ç¯å…‰ ç±»å‹="ç¯å¢ƒå…‰" é¢œè‰²="#ffffff" å¼ºåº¦="0.5">
          </ç¯å…‰>
          <ç¯å…‰ ç±»å‹="ç‚¹å…‰æº" é¢œè‰²="#ffffff" å¼ºåº¦="1" è·ç¦»="100">
              <å‚æ•° ç±»å‹="ä½ç½®" x="1" y="1" z="1" />
          </ç¯å…‰>
          <ç‰©ä½“ åç§°="åœˆåœˆ">
              <å‚æ•° ç±»å‹="ä½ç½®" x="0" y="0" z="0" />
              <å‚æ•° ç±»å‹="æ—‹è½¬" x="0" y="0" z="0" />
              <å‚æ•° ç±»å‹="ç¼©æ”¾" x="1" y="1" z="1" />
              <å‡ ä½•ä½“ å½¢çŠ¶="åœ†å½¢" åŠå¾„="1.5" åˆ†æ®µæ•°="32" />
              <æè´¨ ç±»å‹="æ ‡å‡†" é¢œè‰²="#ffff00" åŒé¢="æ˜¯" />
          </ç‰©ä½“>
          <æ¨¡å‹ åç§°="å†°å¢©å¢©" è·¯å¾„="å†°å¢©å¢©.glb">
              <å‚æ•° ç±»å‹="ä½ç½®" x="0" y="3" z="0" />
              <å‚æ•° ç±»å‹="ç¼©æ”¾" x="5" y="5" z="5" />
          </æ¨¡å‹>
      </åœºæ™¯>
    </script>
</body>
```

### VRé…ç½®
```html
<åœºæ™¯>
	<æ§åˆ¶å™¨ ç±»å‹="é¥æ„Ÿ">
		<å‚æ•° ç±»å‹="ä½ç½®" x="0" y="4" z="20" />
		<å‚æ•° ç±»å‹="èšç„¦" x="0" y="4" z="0" />
	</æ§åˆ¶å™¨>
	<VRé•œå¤´ />
</åœºæ™¯>
```

### åŠ è½½gltfæ¨¡å‹
```html
<åœºæ™¯>
  <æ¨¡å‹ åç§°="å†°å¢©å¢©" è·¯å¾„="å†°å¢©å¢©.glb"><!---å–åç§° å¥½ä»£ç æ§åˆ¶ --->
	  <å‚æ•° ç±»å‹="ä½ç½®" x="0" y="3" z="0" />
	  <å‚æ•° ç±»å‹="ç¼©æ”¾" x="5" y="5" z="5" />
  </æ¨¡å‹>
</åœºæ™¯>
```

### å…¨æ™¯è§†é¢‘
```html
<åœºæ™¯>
	<å…¨æ™¯è§†é¢‘  è·¯å¾„="demo.mp4"  å¾ªç¯="true"  é™éŸ³="false"  è‡ªåŠ¨æ’­æ”¾="true" /><!--- é™éŸ³trueè‡ªåŠ¨æ’­æ”¾ï¼Œå¦‚æœæ˜¯falseå°±ä¼šå¼¹çª—ç‚¹å‡»æ’­æ”¾ --->
</åœºæ™¯>
```

### å…¨æ™¯å›¾ç‰‡
```html
<åœºæ™¯>
	<å…¨æ™¯å›¾ç‰‡  è·¯å¾„="movie.jpg" /><!---æ”¯æŒ exr --->
</åœºæ™¯>
```

### æ–‡å­—ç²¾çµ
```html
<æ–‡å­—ç²¾çµ æ–‡æœ¬="ğŸ¤\nä½ å¥½ï¼Œä¸–ç•Œï¼" å­—ä½“="Arial" å­—å·="30" å­—ä½“é¢œè‰²="#ffffff" å­—ä½“è¾¹æ¡†é¢œè‰²="#000000" 
å­—ä½“è¾¹æ¡†çº¿å®½="0" å¯¹é½æ–¹å¼="center" èƒŒæ™¯è¾¹æ¡†é¢œè‰²="#ffff0099" èƒŒæ™¯é¢œè‰²="#00ff0000" å­—é—´è·="2"  è¡Œé«˜="40">
	<å‚æ•° ç±»å‹="ä½ç½®" x="0" y="7" z="0" />
</æ–‡å­—ç²¾çµ>
```

### JavaScript è„šæœ¬

åœ¨ JavaScript è„šæœ¬ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ `import` å¼•å…¥äº†ä¸€ä¸ªåä¸º `åŠ è½½åœºæ™¯` çš„æ¨¡å—ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥åˆ›å»ºå’Œç®¡ç† Three.js åœºæ™¯ã€‚

```js
import åŠ è½½åœºæ™¯ from "three-js-es";

const ç®¡ç† = new åŠ è½½åœºæ™¯("#æˆ‘çš„åœºæ™¯");
```

ç„¶åï¼Œæˆ‘ä»¬åœ¨ `æ›´æ–°` å‡½æ•°ä¸­å¯¹åœºæ™¯ä¸­çš„ç‰©ä½“è¿›è¡Œä¸€äº›åŠ¨ç”»æ•ˆæœçš„æ“ä½œã€‚

```js
ç®¡ç†.æ›´æ–° = () => {
    // è·å–å†°å¢©å¢©å¯¹è±¡
    const å†°å¢©å¢© = ç®¡ç†.è·å–å¯¹è±¡("å†°å¢©å¢©");
    // æ¯å¸§æ—‹è½¬å†°å¢©å¢©
    å†°å¢©å¢©.æ—‹è½¬.y += 0.01;
    // è®¡ç®— X è½´æ–¹å‘ä¸Šçš„å‘¨æœŸæ€§å¹³ç§»é‡
    const xå‘¨æœŸ = 2; // X ä½ç§»çš„å‘¨æœŸï¼Œå•ä½ä¸ºç§’
    const xæŒ¯å¹… = 1; // X ä½ç§»çš„æŒ¯å¹…
    const xé€Ÿåº¦ = 0.1; // X ä½ç§»çš„é€Ÿåº¦
    const xç§»åŠ¨ = Math.sin(æ—¶é—´ * xé€Ÿåº¦ / xå‘¨æœŸ) * xæŒ¯å¹…;
    // åº”ç”¨å¹³ç§»é‡
    å†°å¢©å¢©.ä½ç½®.x = xç§»åŠ¨;

    // è·å–åœ†å½¢å¯¹è±¡
    const åœˆåœˆ = ç®¡ç†.è·å–å¯¹è±¡("åœˆåœˆ");
    // æ¯å¸§æ—‹è½¬åœ†å½¢
    åœˆåœˆ.æ—‹è½¬.y += 0.01;

    // æ›´æ–°æ—¶é—´å˜é‡
    æ—¶é—´++;
};
ç®¡ç†.è¿è¡Œ();
```

### è‡ªå®šä¹‰æ ‡ç­¾ ä¸‹é¢æ˜¯é«˜çº§å®šä¹‰ æ²¡ç©ºå®ç°æ’ä»¶ä¸­æ–‡
```html
<scene>
  <è‡ªå®šä¹‰å¯¹è±¡ é¢œè‰²="#ff0000">
	<å‚æ•° ç±»å‹="ä½ç½®" x="0" y="0" z="0" />
  </è‡ªå®šä¹‰å¯¹è±¡>
</scene>

class CustomObject extends THREE.Object3D {
	constructor(elem) {
		super();
		const color = parseInt(elem.getAttribute("é¢œè‰²") ? elem.getAttribute("é¢œè‰²").replace("#", "") : "#ffffff", 16);
		const geometry = new THREE.SphereGeometry(0.5, 32, 32);
		const material = new THREE.MeshStandardMaterial({
			color: color,
			roughness: 0.4,
			metalness: 0.5
		});
		this.mesh = new THREE.Mesh(geometry, material);
		this.add(this.mesh);
		const transform = { position: new THREE.Vector3() };
		for (const param of [...elem.getElementsByTagName("å‚æ•°")]) {
			const type = param.getAttribute("ç±»å‹");
			switch (type) {
				case "ä½ç½®":
					transform.position.set(parseFloat(param.getAttribute("x")), parseFloat(param.getAttribute("y")), parseFloat(param.getAttribute("z")));
					break;
			}
		}

		const { position } = transform;
		this.position.copy(position);
		return this;
	}
}

ç®¡ç†.æ³¨å†Œ("è‡ªå®šä¹‰å¯¹è±¡", "customobject", CustomObject);

ç®¡ç†.è¿è¡Œ();
```

## å‚è€ƒèµ„æ–™

- [Three.js](https://threejs.org/)
- [ES Modules in Depth](https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/)